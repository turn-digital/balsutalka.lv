---
import "~styles/styles.scss";
import Layout from "../layouts/Layout.astro";
import Header from "~components/Header/Header.jsx";
import Hero from "~components/Hero/Hero.jsx";
import Future from "~components/Future/Future.jsx";
import Graph from "~components/Graph/Graph.jsx";
import Faq from "~components/Faq/Faq.astro";
import Footer from "~components/Footer/Footer.astro";
import Implementers from "~components/Implementers/Implementers.jsx";
import { t, changeLanguage } from "i18next";

changeLanguage("lv");

const hours = await fetch(t("index.graphDataUrl"))
    .then(response => response.json())
    // item id 4 is the most recent data
    .then(data => {
    return {
        valid: Math.floor(data[4].valid / (60 * 60)),
        total: Math.floor(data[4].total / (60 * 60))
    };
})
    // fallback, last known value if we did not get ant data from CommonVoice
    .catch(() => {
    return {
        valid: Number(t("index.graphFallbackValidated")),
        total: Number(t("index.graphFallbackRecorded"))
    };
});
---

<Layout title={t("global.metaTitle")} desc={t("index.metaDesc")}>
  <main>
    <Header />
    <Future />
    <Hero />
    <Graph hours={hours} />
    <Faq />
    <Implementers />
    <Footer />
  </main>
</Layout>
